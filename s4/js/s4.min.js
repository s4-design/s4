/*!
 * S4 v0.0.0 - https://github.com/s4-design/s4
 * Copyright (c) 2024 Arthur A. Selimov
 * Released under the CC BY-NC-SA License
 */
const baseUrl=document.currentScript.src.substring(0,document.currentScript.src.lastIndexOf("js/"));function loadScript(e){return new Promise(((t,n)=>{const a=document.createElement("script");a.src=e;a.onload=t;a.onerror=n;document.head.appendChild(a)}))}const loadedLinks=new Set;async function loadDependencyMap(e){try{const t=await fetch(e);if(!t.ok){throw new Error(`Ошибка загрузки JSON | Loading error JSON: ${t.statusText}`)}const n=await t.json();return n}catch(e){console.error("Ошибка при загрузке или парсинге dependencyMap | Error loading or parsing dependencyMap:",e);return{desktop:{landscape:[{desktop:"landscape"}],portrait:[{desktop:"portrait"}]},tablet:{landscape:[{tablet:"landscape"}],portrait:[{tablet:"portrait"}]},mobile:{landscape:[{mobile:"landscape"}],portrait:[{mobile:"portrait"}]}}}}function loadLink(e,t=""){if(loadedLinks.has(e)){}else{const n=document.createElement("link");n.id=t;n.href=e;n.rel="stylesheet";n.type="text/css";document.head.appendChild(n);loadedLinks.add(e)}}function areDependenciesEqual(e,t){return Object.keys(e)[0]===Object.keys(t)[0]&&Object.values(e)[0]===Object.values(t)[0]}function updateLinks(e,t){e.forEach((e=>{const[t]=Object.keys(e);loadLink(`${baseUrl}css/${t}/${e[t]}.css`,`${t}/${e[t]}`)}));loadLink(`${baseUrl}css/${device.type}/themes.css`,`${device.type}/themes`);t.forEach((t=>{const[n]=Object.keys(t);const a=document.getElementById(`${n}/${t[n]}`);if(a&&!e.some((e=>areDependenciesEqual(e,t)))){a.remove();loadedLinks.delete(`${baseUrl}css/${n}/${t[n]}.css`)}}))}async function S4(){try{await loadScript(`${baseUrl}js/current-device.min.js`);const e=await loadDependencyMap(`${baseUrl}dependency-map.json`);if(!device)throw new Error("Объект device не определен | The device object is not defined");let t=device.type,n=device.orientation,a=e[t]?.[n]||[];updateLinks(a,Object.values(e).flatMap((e=>Object.values(e).flat())));loadLink(`${baseUrl}css/elements.css`,"css/elements");device.onChangeOrientation((async s=>{if(n!==s){n=s;a=e[t]?.[n]||[];updateLinks(a,Object.values(e).flatMap((e=>Object.values(e).flat())))}}))}catch(e){console.error("Ошибка при загрузке скрипта или инициализации устройства | Error loading script or initializing device:",e)}}